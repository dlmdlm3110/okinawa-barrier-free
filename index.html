<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>沖縄バリアフリー旅行プランナーAI | リアルタイムプラン生成</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        :root {
            --okinawa-blue: #3498db;
            --okinawa-light-blue: #e3f2fd;
            --okinawa-orange: #FF9E1B;
            --okinawa-light-orange: #fff8e1;
        }
        body {
            background-color: #f0f8ff;
            background-image: linear-gradient(120deg, #e0f7fa 0%, #f0f8ff 100%);
            min-height: 100vh;
        }
        .btn-primary {
            background-color: var(--okinawa-orange);
            border-color: var(--okinawa-orange);
            color: white;
            transition: all 0.3s;
        }
        .btn-primary:hover {
            background-color: #e08c00;
            border-color: #e08c00;
        }
        .btn-secondary {
            background-color: var(--okinawa-blue);
            border-color: var(--okinawa-blue);
            color: white;
            transition: all 0.3s;
        }
        .btn-secondary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        .section-header {
            color: var(--okinawa-blue);
            border-bottom: 2px solid var(--okinawa-orange);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .info-box {
            background-color: var(--okinawa-light-blue);
            border-left: 4px solid var(--okinawa-blue);
        }
        .warning-box {
            background-color: var(--okinawa-light-orange);
            border-left: 4px solid var(--okinawa-orange);
        }
        .plan-box {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--okinawa-blue);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.25);
        }
        .toggle-input:checked + .toggle-label {
            background-color: var(--okinawa-orange);
        }
        .main-header {
            background: linear-gradient(90deg, var(--okinawa-blue), var(--okinawa-orange));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        .loading-wave {
            width: 5px;
            height: 100px;
            background: linear-gradient(45deg, var(--okinawa-blue), var(--okinawa-orange));
            margin: 10px;
            animation: wave 1s linear infinite;
            border-radius: 20px;
        }
        .loading-wave:nth-child(2) {
            animation-delay: 0.1s;
        }
        .loading-wave:nth-child(3) {
            animation-delay: 0.2s;
        }
        .loading-wave:nth-child(4) {
            animation-delay: 0.3s;
        }
        .loading-wave:nth-child(5) {
            animation-delay: 0.4s;
        }
        @keyframes wave {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1);
            }
            100% {
                transform: scale(0);
            }
        }
        
        .taxi-info {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
        }
        
        .taxi-contact {
            font-weight: bold;
            color: #d32f2f;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <header class="bg-white shadow-md py-4">
        <div class="container mx-auto px-4 flex items-center justify-between">
            <h1 class="text-3xl md:text-4xl main-header">
                <i class="fas fa-wheelchair mr-2"></i> 沖縄バリアフリー旅行プランナーAI
            </h1>
            <div class="flex items-center">
                <a href="#about" class="text-gray-600 hover:text-gray-800 mx-2 hidden md:block">
                    <i class="fas fa-info-circle mr-1"></i> このサイトについて
                </a>
                <a href="#contact" class="text-gray-600 hover:text-gray-800 mx-2 hidden md:block">
                    <i class="fas fa-envelope mr-1"></i> お問い合わせ
                </a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <div class="mb-8 p-4 bg-white rounded-lg shadow-md">
            <h2 class="text-xl md:text-2xl mb-4 section-header flex items-center">
                <i class="fas fa-key mr-2"></i> Google Gemini APIキー設定
            </h2>
            <div class="mb-4 info-box p-4 rounded-lg">
                <p class="mb-2"><i class="fas fa-info-circle text-blue-500 mr-2"></i>このアプリを使用するには、Google Gemini APIキーが必要です。</p>
                <p class="mb-2">APIキーは<a href="https://ai.google.dev/" target="_blank" class="text-blue-500 underline">Google AI Studio</a>から取得できます。</p>
                <p>初めて使用する場合は、Google AI Studioに登録してAPIキーを発行してください。</p>
            </div>
            <div class="relative">
                <input type="password" id="apiKeyInput" class="w-full p-2 border rounded focus:outline-none" placeholder="Google Gemini APIキーを入力してください">
                <button id="saveApiKey" class="absolute right-2 top-2 bg-blue-500 text-white px-3 py-1 rounded">
                    保存
                </button>
                <button id="toggleApiKey" class="absolute right-20 top-2 bg-gray-200 text-gray-700 px-3 py-1 rounded">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <div id="apiKeyStatus" class="mt-2 hidden">
                <p class="text-green-500"><i class="fas fa-check-circle mr-1"></i> APIキーが保存されました。</p>
            </div>
            <div class="mt-4 text-sm text-gray-600">
                <p><i class="fas fa-shield-alt mr-1"></i> セキュリティのため、APIキーはお使いのブラウザにのみ保存され、サーバーには送信されません。</p>
                <p><i class="fas fa-info-circle mr-1"></i> 最新の「gemini-1.5-pro」モデルを使用しています。</p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow-md p-4">
                <h2 class="text-xl md:text-2xl mb-4 section-header flex items-center">
                    <i class="fas fa-edit mr-2"></i> 旅行条件を入力
                </h2>
                <form id="travelForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium mb-2">観光できる時間帯</label>
                        <div class="flex items-center space-x-2">
                            <div class="w-1/2">
                                <label class="block text-gray-600 text-sm mb-1">開始時間</label>
                                <input type="time" id="startTime" class="w-full p-2 border rounded" value="09:00" required>
                            </div>
                            <span class="text-gray-500">〜</span>
                            <div class="w-1/2">
                                <label class="block text-gray-600 text-sm mb-1">終了時間</label>
                                <input type="time" id="endTime" class="w-full p-2 border rounded" value="17:00" required>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium mb-2">人数</label>
                        <div class="flex items-center space-x-4">
                            <div class="w-1/2">
                                <label class="block text-gray-600 text-sm mb-1">車椅子利用者</label>
                                <input type="number" id="wheelchairUsers" min="1" value="1" class="w-full p-2 border rounded" required>
                            </div>
                            <div class="w-1/2">
                                <label class="block text-gray-600 text-sm mb-1">同行者</label>
                                <input type="number" id="companions" min="0" value="1" class="w-full p-2 border rounded" required>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium mb-2">興味のあるテーマ（複数選択可）</label>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="flex items-center">
                                <input type="checkbox" id="nature" class="mr-2" checked>
                                <label for="nature">自然</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="sightseeing" class="mr-2" checked>
                                <label for="sightseeing">観光地</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="history" class="mr-2">
                                <label for="history">歴史</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="gourmet" class="mr-2" checked>
                                <label for="gourmet">グルメ</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="shopping" class="mr-2">
                                <label for="shopping">買い物</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="relaxation" class="mr-2" checked>
                                <label for="relaxation">ゆっくり休憩</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium mb-2">滞在エリアの希望</label>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="flex items-center">
                                <input type="radio" name="area" id="south" value="南部" class="mr-2">
                                <label for="south">南部</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" name="area" id="central" value="中部" class="mr-2" checked>
                                <label for="central">中部</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" name="area" id="north" value="北部" class="mr-2">
                                <label for="north">北部</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" name="area" id="any" value="エリアおまかせ" class="mr-2">
                                <label for="any">エリアおまかせ</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium mb-2">バリアフリー対応の希望（複数選択可）</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                            <div class="flex items-center">
                                <input type="checkbox" id="wheelchair_toilet" class="mr-2" checked>
                                <label for="wheelchair_toilet">車椅子対応トイレあり</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="ramp_facilities" class="mr-2" checked>
                                <label for="ramp_facilities">スロープ付き施設</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="low_step_restaurant" class="mr-2" checked>
                                <label for="low_step_restaurant">段差の少ない飲食店</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="staff_support" class="mr-2">
                                <label for="staff_support">補助スタッフがいる場所</label>
                            </div>
                            <div class="flex items-center md:col-span-2">
                                <input type="checkbox" id="scenic_place" class="mr-2" checked>
                                <label for="scenic_place">景色がきれいな場所</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium mb-2">その他の希望やリクエスト（任意）</label>
                        <textarea id="additionalRequests" class="w-full p-2 border rounded" rows="3" placeholder="特別なご要望があればこちらにご記入ください"></textarea>
                    </div>

                    <button type="submit" id="generatePlanBtn" class="w-full p-3 btn-primary rounded-lg font-medium shadow-md flex justify-center items-center">
                        <i class="fas fa-magic mr-2"></i> 旅行プランを作成する
                    </button>
                </form>
            </div>

            <div class="bg-white rounded-lg shadow-md p-4">
                <h2 class="text-xl md:text-2xl mb-4 section-header flex items-center">
                    <i class="fas fa-route mr-2"></i> 旅行プラン
                </h2>
                <div id="resultsArea" class="min-h-[300px]">
                    <div id="initialMessage" class="text-center py-12">
                        <div class="text-6xl mb-4 text-gray-300">
                            <i class="fas fa-map-marked-alt"></i>
                        </div>
                        <h3 class="text-xl text-gray-500 mb-2">旅行プランが表示されます</h3>
                        <p class="text-gray-400">左側のフォームから条件を入力し、「旅行プランを作成する」ボタンをクリックしてください。</p>
                    </div>
                    
                    <div id="loadingIndicator" class="hidden py-12 flex flex-col items-center">
                        <div class="flex justify-center mb-4">
                            <div class="loading-wave"></div>
                            <div class="loading-wave"></div>
                            <div class="loading-wave"></div>
                            <div class="loading-wave"></div>
                            <div class="loading-wave"></div>
                        </div>
                        <p class="text-gray-600">旅行プランを生成中です。少々お待ちください...</p>
                    </div>
                    
                    <div id="errorMessage" class="hidden py-8">
                        <div class="warning-box p-4 rounded-lg mb-4">
                            <div class="text-xl text-red-500 mb-2 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                <span>エラーが発生しました</span>
                            </div>
                            <p id="errorDetails" class="text-gray-700 mb-2"></p>
                            <div class="bg-gray-100 p-3 rounded-lg">
                                <h4 class="font-medium mb-2">考えられる原因と対処法：</h4>
                                <ul class="list-disc pl-5 space-y-1 text-sm">
                                    <li>APIキーが無効または期限切れです。Google AI Studioで新しいキーを発行してください。</li>
                                    <li>APIキーの入力に誤りがないか確認してください。</li>
                                    <li>Gemini APIの利用制限に達している可能性があります。しばらく時間をおいてから再試行してください。</li>
                                    <li>インターネット接続に問題がある可能性があります。接続を確認してください。</li>
                                </ul>
                            </div>
                        </div>
                        <div class="taxi-info">
                            <h3 class="font-bold mb-2">【介護タクシーのご利用をおすすめします】</h3>
                            <p>沖縄での車椅子旅行には、専門知識を持ったスタッフによる介護タクシーのご利用が便利です。</p>
                            <p class="taxi-contact mt-2">📞 介護タクシーいまここ：090-9011-8526</p>
                            <ul class="mt-2 list-none">
                                <li>✅ 車椅子のままでの乗車が可能</li>
                                <li>✅ バリアフリースポットに詳しいドライバー</li>
                                <li>✅ 観光中の介助サポートも可能</li>
                                <li>✅ 事前予約で安心・確実な移動</li>
                            </ul>
                        </div>
                        <button id="retryButton" class="w-full p-3 mt-4 btn-secondary rounded-lg font-medium shadow-md flex justify-center items-center">
                            <i class="fas fa-sync-alt mr-2"></i> 再試行する
                        </button>
                        <button id="useOfflineButton" class="w-full p-3 mt-2 bg-gray-500 text-white rounded-lg font-medium shadow-md flex justify-center items-center hover:bg-gray-600">
                            <i class="fas fa-database mr-2"></i> オフラインプランを表示
                        </button>
                    </div>
                    
                    <div id="planResult" class="hidden">
                        <div class="mb-4 info-box p-2 rounded-lg" id="timeRange"></div>
                        <div class="plan-box p-4 mb-4" id="planContent"></div>
                        
                        <div id="tipSection" class="mb-4">
                            <h3 class="text-lg font-medium mb-2 flex items-center">
                                <i class="fas fa-lightbulb text-yellow-500 mr-2"></i> 旅行のヒントとアドバイス
                            </h3>
                            <div class="warning-box p-3 rounded-lg" id="planTips">
                                <div class="taxi-info">
                                    <h3 class="font-bold mb-2">【介護タクシーのご利用をおすすめします】</h3>
                                    <p>沖縄での車椅子旅行には、専門知識を持ったスタッフによる介護タクシーのご利用が便利です。</p>
                                    <p class="taxi-contact mt-2">📞 介護タクシーいまここ：090-9011-8526</p>
                                    <ul class="mt-2 list-none">
                                        <li>✅ 車椅子のままでの乗車が可能</li>
                                        <li>✅ バリアフリースポットに詳しいドライバー</li>
                                        <li>✅ 観光中の介助サポートも可能</li>
                                        <li>✅ 事前予約で安心・確実な移動</li>
                                    </ul>
                                    <p class="mt-2">観光スポット間の移動や、一日観光には特におすすめです。ぜひご検討ください。</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-2">
                            <button id="copyPlanBtn" class="p-2 btn-primary rounded-lg font-medium shadow-md flex justify-center items-center">
                                <i class="fas fa-copy mr-2"></i> コピー
                            </button>
                            <button id="printPlanBtn" class="p-2 btn-secondary rounded-lg font-medium shadow-md flex justify-center items-center">
                                <i class="fas fa-print mr-2"></i> 印刷
                            </button>
                            <button id="newPlanBtn" class="p-2 bg-gray-500 text-white rounded-lg font-medium shadow-md flex justify-center items-center hover:bg-gray-600">
                                <i class="fas fa-plus mr-2"></i> 新規作成
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 bg-white rounded-lg shadow-md p-4" id="about">
            <h2 class="text-xl md:text-2xl mb-4 section-header">
                <i class="fas fa-info-circle mr-2"></i> このサイトについて
            </h2>
            <p class="mb-4">沖縄バリアフリー旅行プランナーAIは、車椅子ユーザーやその家族が沖縄旅行を楽しむためのプランを生成するツールです。バリアフリー対応の観光スポット、レストラン、交通手段などを考慮した旅行プランを提供します。</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 info-box rounded-lg">
                    <h3 class="font-medium mb-2 flex items-center">
                        <i class="fas fa-wheelchair text-blue-500 mr-2"></i> バリアフリー対応
                    </h3>
                    <p class="text-sm">車椅子利用者が快適に観光できるよう、バリアフリー対応施設を中心にプランを作成します。</p>
                </div>
                <div class="p-4 info-box rounded-lg">
                    <h3 class="font-medium mb-2 flex items-center">
                        <i class="fas fa-clock text-blue-500 mr-2"></i> 時間配分
                    </h3>
                    <p class="text-sm">移動時間や休憩時間を考慮した、無理のない時間配分のプランを提供します。</p>
                </div>
                <div class="p-4 info-box rounded-lg">
                    <h3 class="font-medium mb-2 flex items-center">
                        <i class="fas fa-robot text-blue-500 mr-2"></i> AI活用
                    </h3>
                    <p class="text-sm">Google Gemini AIを活用して、ユーザーの希望条件に合わせたプランを自動生成します。</p>
                </div>
            </div>
        </div>

        <div class="mt-8 bg-white rounded-lg shadow-md p-4" id="contact">
            <h2 class="text-xl md:text-2xl mb-4 section-header">
                <i class="fas fa-envelope mr-2"></i> お問い合わせ
            </h2>
            <p class="mb-4">沖縄バリアフリー旅行プランナーAIに関するご質問やご意見、バリアフリー情報の追加提案などがございましたら、以下の連絡先までお寄せください。</p>
            <div class="info-box p-4 rounded-lg">
                <p class="mb-2"><strong>介護タクシーいまここ</strong></p>
                <p class="mb-2"><i class="fas fa-phone-alt mr-2 text-blue-500"></i> 電話: 090-9011-8526</p>
                <p class="mb-4">沖縄での車椅子旅行のサポートや介護タクシーのご利用についてお気軽にお問い合わせください。</p>
                
                <p class="mb-2"><strong>バリアフリー情報リンク</strong></p>
                <ul class="list-disc pl-5 space-y-1">
                    <li><a href="http://okinawa-bf-map.jp/" target="_blank" class="text-blue-500 hover:underline">沖縄県バリアフリーマップ</a></li>
                    <li><a href="http://barifuri-okinawa.org/BFtourcenter/" target="_blank" class="text-blue-500 hover:underline">沖縄バリアフリーツアーセンター</a></li>
                    <li><a href="https://cbs-okinawa.studio.site/" target="_blank" class="text-blue-500 hover:underline">CBS沖縄バリアフリー情報</a></li>
                    <li><a href="https://www.okinawastory.jp/feature/barrier_free/" target="_blank" class="text-blue-500 hover:underline">おきなわ物語（バリアフリー情報）</a></li>
                </ul>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h3 class="text-lg font-medium mb-3">沖縄バリアフリー旅行プランナーAI</h3>
                    <p class="text-gray-300 text-sm">車椅子ユーザーとそのご家族のための沖縄旅行をサポートします。</p>
                </div>
                <div>
                    <h3 class="text-lg font-medium mb-3">関連リンク</h3>
                    <ul class="text-gray-300 text-sm space-y-2">
                        <li><a href="http://okinawa-bf-map.jp/" target="_blank" class="hover:text-white"><i class="fas fa-external-link-alt mr-1"></i> 沖縄県バリアフリーマップ</a></li>
                        <li><a href="http://barifuri-okinawa.org/BFtourcenter/" target="_blank" class="hover:text-white"><i class="fas fa-external-link-alt mr-1"></i> 沖縄バリアフリーツアーセンター</a></li>
                        <li><a href="https://cbs-okinawa.studio.site/" target="_blank" class="hover:text-white"><i class="fas fa-external-link-alt mr-1"></i> CBS沖縄バリアフリー情報</a></li>
                        <li><a href="https://www.okinawastory.jp/" target="_blank" class="hover:text-white"><i class="fas fa-external-link-alt mr-1"></i> おきなわ物語（沖縄観光情報）</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-medium mb-3">介護タクシーサービス</h3>
                    <div class="text-gray-300 text-sm space-y-2">
                        <p><i class="fas fa-taxi mr-1"></i> <strong>介護タクシーいまここ</strong></p>
                        <p><i class="fas fa-phone-alt mr-1"></i> 090-9011-8526</p>
                        <p><i class="fas fa-info-circle mr-1"></i> 車椅子のままで乗車可能</p>
                        <p><i class="fas fa-map-marker-alt mr-1"></i> 沖縄全域で対応</p>
                    </div>
                </div>
            </div>
            <div class="mt-6 pt-4 border-t border-gray-700 text-center text-gray-400 text-sm">
                <p>© 2025 沖縄バリアフリー旅行プランナーAI | 安心して沖縄を楽しむための旅行サポートツール</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // バリアフリー対応施設データ
            const barrierFreeSpots = {
                "tourist_spots": [
                    {
                        "name": "首里城公園",
                        "area": "南部",
                        "features": ["スロープあり", "車椅子対応トイレあり", "エレベーターあり", "車椅子貸出あり（無料・電動）"],
                        "description": "首里城はバリアフリー化が進められており、車椅子でも観光が楽しめます。電動車椅子の貸出サービスもあります。"
                    },
                    {
                        "name": "沖縄美ら海水族館",
                        "area": "北部",
                        "features": ["スロープあり", "車椅子対応トイレあり", "エレベーターあり", "車椅子貸出あり（無料・電動）"],
                        "description": "施設内の主要動線のほぼすべてを車いすで移動することができます。館内では電動車椅子の貸出も行っています。"
                    },
                    {
                        "name": "国際通り",
                        "area": "南部",
                        "features": ["一部店舗に簡易スロープあり", "車椅子対応トイレあり（周辺施設）"],
                        "description": "沖縄のメインストリート。通りは平坦で移動しやすいですが、一部店舗の入口に段差があります。多くの店舗で簡易スロープが設置されています。"
                    },
                    {
                        "name": "平和祈念公園",
                        "area": "南部",
                        "features": ["スロープあり", "車椅子対応トイレあり", "バリアフリー環境整備"],
                        "description": "バリアフリー環境が整っており、車椅子でのアクセスが可能です。平和記念資料館も車椅子で見学できます。"
                    },
                    {
                        "name": "OKINAWAフルーツらんど",
                        "area": "中部",
                        "features": ["バリアフリー対応", "車椅子対応トイレあり", "スロープあり"],
                        "description": "トロピカルフルーツが楽しめるテーマパーク。園内はほぼフラットな造りで車椅子での移動も快適です。"
                    }
                ],
                "beaches": [
                    {
                        "name": "あざまサンサンビーチ",
                        "area": "南部",
                        "features": ["水陸両用車椅子（モビチェアー）あり", "車椅子対応トイレあり", "バリアフリー環境"],
                        "description": "沖縄県初の年間を通じてのユニバーサルデザインビーチ。モビマットの常設、水陸両用の車椅子も配備。"
                    },
                    {
                        "name": "オリオンECO美らSUNビーチ",
                        "area": "南部",
                        "features": ["水陸両用車椅子（チェアボート）あり", "車椅子専用トイレ", "シャワーあり", "スロープあり"],
                        "description": "空港から車で約15分。車椅子で使いやすい駐車場とトイレを完備。BBQも可能なバリアフリービーチ。"
                    },
                    {
                        "name": "波の上ビーチ",
                        "area": "南部",
                        "features": ["車椅子用マットあり", "バリアフリートイレあり"],
                        "description": "那覇市内からアクセスが良く、車椅子でも砂浜に近づけるマットが設置されています。"
                    }
                ],
                "restaurants": [
                    {
                        "name": "琉球肉バル A Sign",
                        "area": "南部",
                        "features": ["スロープあり", "車椅子対応トイレあり", "テーブル席あり"],
                        "description": "那覇市内にある車椅子でも利用しやすい沖縄料理のレストラン。"
                    },
                    {
                        "name": "沖縄菜園ビュッフェ カラカラ",
                        "area": "中部",
                        "features": ["バリアフリー対応", "テーブル席あり", "店内広々"],
                        "description": "沖縄の食材を使ったビュッフェレストラン。店内は広く、車椅子での移動もスムーズです。"
                    },
                    {
                        "name": "ふくぎカフェ",
                        "area": "北部",
                        "features": ["段差なし", "車椅子OK", "テラス席あり"],
                        "description": "自然に囲まれた古民家カフェ。入口の段差がなく、テラス席も利用可能です。"
                    },
                    {
                        "name": "琉旬彩食 土煌",
                        "area": "南部",
                        "features": ["車椅子で入店可", "バリアフリートイレあり", "テーブル席あり"],
                        "description": "沖縄料理が楽しめる店。テーブル席は車椅子でも利用しやすい高さに設定されています。"
                    }
                ],
                "transport": [
                    {
                        "name": "ゆいレール（沖縄都市モノレール）",
                        "area": "南部",
                        "features": ["エレベーターあり", "車椅子対応トイレあり", "駅員によるサポートあり"],
                        "description": "那覇空港から首里までを結ぶモノレール。全駅にエレベーターが設置され、車椅子での利用が可能です。"
                    },
                    {
                        "name": "バリアフリー対応バス",
                        "area": "全域",
                        "features": ["ノンステップバスあり", "車椅子スペースあり", "運転手による補助あり"],
                        "description": "沖縄の路線バスにはノンステップバスが導入されており、車椅子での乗車が可能です。"
                    },
                    {
                        "name": "介護タクシーいまここ",
                        "area": "全域",
                        "features": ["福祉車両あり", "乗降補助あり", "車椅子積載可能", "観光サポート"],
                        "description": "車椅子のまま乗車可能な介護タクシー。沖縄観光にも詳しく、観光案内も可能です。電話：090-9011-8526"
                    },
                    {
                        "name": "レンタカー（福祉車両）",
                        "area": "全域",
                        "features": ["スロープ付き車両あり", "手動運転装置付き車両あり"],
                        "description": "車椅子に対応したレンタカーも予約可能です。事前予約が必要です。"
                    }
                ]
            };

            // サンプルプランデータ
            const samplePlans = {
                "南部": {
                    "timeRange": "9:00～17:00",
                    "plan": `🕘 09:00 出発（那覇市内ホテル）<br><br>
🏯 09:30～11:00 首里城公園（スロープあり、車椅子対応トイレあり、電動車椅子貸出あり）<br>
沖縄の象徴的な世界遺産。バリアフリー化が進められており、車椅子ユーザーでもほとんどのエリアを見学できます。正殿へは専用の斜行リフトが設置されています。<br><br>
☕ 11:30～12:30 琉球肉バル A Sign（スロープあり、車椅子対応トイレあり）<br>
那覇市内にある車椅子でも利用しやすい沖縄料理のレストラン。テーブル席は車椅子でも利用しやすい高さに設定されています。<br><br>
🌊 13:00～14:30 波の上ビーチ（車椅子用マットあり、バリアフリートイレあり）<br>
那覇市内からアクセスが良く、車椅子でも砂浜に近づけるマットが設置されています。ビーチを眺めながらゆったりと休憩できます。<br><br>
🛍️ 15:00～16:30 国際通り（一部店舗に簡易スロープあり、周辺に車椅子対応トイレあり）<br>
沖縄のメインストリート。通りは平坦で移動しやすいですが、一部店舗の入口に段差があります。多くの店舗で簡易スロープが設置されています。お土産選びも楽しめます。<br><br>
🕔 17:00 ホテルに帰着`,
                    "tips": `天候に応じて計画を調整しましょう。特に雨天時は波の上ビーチの代わりに沖縄県立博物館・美術館（バリアフリー対応、車椅子貸出あり）への訪問がおすすめです。<br><br>
首里城では無料の電動車椅子貸出サービスがあるので、長時間の見学で疲れる心配がある方は利用するとよいでしょう。事前予約は不要ですが、数に限りがあります。<br><br>
国際通りでは、平日の午後が比較的空いていて移動しやすいです。週末や祝日は混雑するため、車椅子での移動が難しくなる場合があります。<br><br>
各施設への移動には介護タクシーの利用が便利です。特にホテルから首里城、首里城から昼食場所への移動は坂道が多いため、タクシーの利用をおすすめします。`
                },
                "中部": {
                    "timeRange": "9:00～17:00",
                    "plan": `🕘 09:00 出発（宜野湾市内ホテル）<br><br>
🌴 09:30～11:30 OKINAWAフルーツらんど（バリアフリー対応、車椅子対応トイレあり、スロープあり）<br>
トロピカルフルーツが楽しめるテーマパーク。園内はほぼフラットな造りで車椅子での移動も快適です。フルーツの試食や、ジュース作り体験も車椅子で参加可能です。<br><br>
🍽️ 12:00～13:30 沖縄菜園ビュッフェ カラカラ（バリアフリー対応、テーブル席あり、店内広々）<br>
沖縄の食材を使ったビュッフェレストラン。店内は広く、車椅子での移動もスムーズです。沖縄の郷土料理を豊富に取り揃えています。<br><br>
🏛️ 14:00～15:30 沖縄コンベンションセンター周辺（バリアフリー対応、スロープあり、多目的トイレあり）<br>
バリアフリー対応の遊歩道が整備されており、美しい海を眺めながら散策できます。車椅子でもアクセスしやすい展望スポットがあります。<br><br>
☕ 16:00～17:00 北谷アメリカンビレッジ内カフェ（スロープあり、バリアフリートイレあり）<br>
アメリカンビレッジ内のカフェでは、車椅子のままテラス席で海を眺めながらコーヒーを楽しむことができます。夕日が美しいスポットとしても知られています。<br><br>
🕔 17:00 ホテルに帰着`,
                    "tips": `OKINAWAフルーツらんどでは、車椅子ユーザーを優先的に案内してくれるスタッフがいます。園内が広いので、入口で声をかけるとスムーズに観光できます。<br><br>
中部エリアは比較的平坦な地形が多いですが、場所によっては緩やかな坂道があります。電動車椅子や介助者がいると安心です。<br><br>
北谷アメリカンビレッジは夕方から夜にかけてイルミネーションが美しいので、夏場など日が長い時期は滞在時間を少し延ばすのもおすすめです。<br><br>
天候によっては海風が強いことがあります。風除け用のブランケットがあると便利です。`
                },
                "北部": {
                    "timeRange": "9:00～17:00",
                    "plan": `🕘 09:00 出発（名護市内ホテル）<br><br>
🐠 09:30～12:00 沖縄美ら海水族館（スロープあり、車椅子対応トイレあり、エレベーターあり、車椅子貸出あり）<br>
施設内の主要動線のほぼすべてを車いすで移動することができます。館内では電動車椅子の貸出も行っています。世界最大級の水槽「黒潮の海」は必見です。<br><br>
☕ 12:30～13:30 ふくぎカフェ（段差なし、車椅子OK、テラス席あり）<br>
自然に囲まれた古民家カフェ。入口の段差がなく、テラス席も利用可能です。沖縄の食材を使用した体に優しいメニューが人気です。<br><br>
🌳 14:00～15:30 備瀬のフクギ並木（一部区間は車椅子で通行可能）<br>
沖縄の原風景が広がる美しい並木道。メイン道路は舗装されており、車椅子でも通行可能です。ただし、砂利道や未舗装の小道もあるため、事前に通行可能なルートを確認しておくとよいでしょう。<br><br>
🌅 16:00～17:00 名護湾の夕日スポット（車椅子対応展望台あり）<br>
車椅子で近づける展望台から、美しい名護湾の夕日を鑑賞できます。駐車場から展望台までは舗装された緩やかな坂道があります。<br><br>
🕔 17:00 ホテルに帰着`,
                    "tips": `沖縄美ら海水族館は人気スポットのため、開館直後または15時以降の訪問がおすすめです。混雑を避けて車椅子での移動がしやすくなります。<br><br>
北部エリアは起伏のある道路が多いため、観光スポット間の移動には介護タクシーの利用が便利です。<br><br>
備瀬のフクギ並木では、通行可能なメインルートを事前に確認しておくとよいでしょう。地元の案内所では車椅子で通行できる道を教えてくれます。<br><br>
沖縄美ら海水族館周辺には、海洋博公園内の熱帯ドリームセンターやエメラルドビーチなど、バリアフリー対応の施設が多くあります。時間に余裕があれば、それらも訪れてみてください。`
                }
            };

            // APIキー関連
            const saveApiKeyBtn = document.getElementById('saveApiKey');
            const apiKeyInput = document.getElementById('apiKeyInput');
            const apiKeyStatus = document.getElementById('apiKeyStatus');
            const toggleApiKey = document.getElementById('toggleApiKey');

            // APIキーの表示/非表示切り替え
            toggleApiKey.addEventListener('click', function() {
                if (apiKeyInput.type === 'password') {
                    apiKeyInput.type = 'text';
                    toggleApiKey.innerHTML = '<i class="fas fa-eye-slash"></i>';
                } else {
                    apiKeyInput.type = 'password';
                    toggleApiKey.innerHTML = '<i class="fas fa-eye"></i>';
                }
            });

            // ローカルストレージからAPIキーを読み込む
            if (localStorage.getItem('geminiApiKey')) {
                apiKeyInput.value = localStorage.getItem('geminiApiKey');
                apiKeyStatus.classList.remove('hidden');
            }

            saveApiKeyBtn.addEventListener('click', function() {
                const apiKey = apiKeyInput.value.trim();
                if (apiKey) {
                    localStorage.setItem('geminiApiKey', apiKey);
                    apiKeyStatus.classList.remove('hidden');
                    setTimeout(() => {
                        apiKeyStatus.classList.add('hidden');
                    }, 3000);
                }
            });

            // フォーム関連の要素
            const travelForm = document.getElementById('travelForm');
            const generatePlanBtn = document.getElementById('generatePlanBtn');
            const initialMessage = document.getElementById('initialMessage');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const errorMessage = document.getElementById('errorMessage');
            const planResult = document.getElementById('planResult');
            const timeRange = document.getElementById('timeRange');
            const planContent = document.getElementById('planContent');
            const planTips = document.getElementById('planTips');
            const tipSection = document.getElementById('tipSection');
            const errorDetails = document.getElementById('errorDetails');
            const retryButton = document.getElementById('retryButton');
            const useOfflineButton = document.getElementById('useOfflineButton');
            
            // ボタン類
            const copyPlanBtn = document.getElementById('copyPlanBtn');
            const printPlanBtn = document.getElementById('printPlanBtn');
            const newPlanBtn = document.getElementById('newPlanBtn');

            travelForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // APIキーの確認
                const apiKey = localStorage.getItem('geminiApiKey');
                if (!apiKey) {
                    showError('APIキーが設定されていません。Google Gemini APIキーを入力して保存してください。');
                    return;
                }
                
                // フォームデータの取得
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                const wheelchairUsers = document.getElementById('wheelchairUsers').value;
                const companions = document.getElementById('companions').value;
                
                // テーマの取得
                const selectedThemes = [];
                if (document.getElementById('nature').checked) selectedThemes.push('自然');
                if (document.getElementById('sightseeing').checked) selectedThemes.push('観光地');
                if (document.getElementById('history').checked) selectedThemes.push('歴史');
                if (document.getElementById('gourmet').checked) selectedThemes.push('グルメ');
                if (document.getElementById('shopping').checked) selectedThemes.push('買い物');
                if (document.getElementById('relaxation').checked) selectedThemes.push('ゆっくり休憩');
                
                // エリアの取得
                let selectedArea = '';
                if (document.getElementById('south').checked) selectedArea = '南部';
                else if (document.getElementById('central').checked) selectedArea = '中部';
                else if (document.getElementById('north').checked) selectedArea = '北部';
                else if (document.getElementById('any').checked) selectedArea = 'エリアおまかせ';
                
                // バリアフリー対応の希望
                const barrierFreeRequests = [];
                if (document.getElementById('wheelchair_toilet').checked) barrierFreeRequests.push('車椅子対応トイレあり');
                if (document.getElementById('ramp_facilities').checked) barrierFreeRequests.push('スロープ付き施設');
                if (document.getElementById('low_step_restaurant').checked) barrierFreeRequests.push('段差の少ない飲食店');
                if (document.getElementById('staff_support').checked) barrierFreeRequests.push('補助スタッフがいる場所');
                if (document.getElementById('scenic_place').checked) barrierFreeRequests.push('景色がきれいな場所');
                
                const additionalRequests = document.getElementById('additionalRequests').value;
                
                // 入力情報をまとめる
                const userInput = {
                    startTime,
                    endTime,
                    wheelchairUsers,
                    companions,
                    themes: selectedThemes,
                    area: selectedArea,
                    barrierFreeRequests,
                    additionalRequests
                };
                
                // ローディング表示
                showLoading();
                
                // Gemini APIのプロンプトを作成
                const prompt = createPrompt(userInput, barrierFreeSpots);
                
                // Gemini APIを呼び出す
                callGeminiAPI(apiKey, prompt)
                    .then(result => {
                        if (result) {
                            // 介護タクシーいまここの情報を追加
                            const taxiInfo = `<div class="taxi-info mt-4">
<h3 class="font-bold mb-2">【介護タクシーのご利用をおすすめします】</h3>
<p>沖縄での車椅子旅行には、専門知識を持ったスタッフによる介護タクシーのご利用が便利です。</p>
<p class="taxi-contact mt-2">📞 介護タクシーいまここ：090-9011-8526</p>
<ul class="mt-2 list-none">
    <li>✅ 車椅子のままでの乗車が可能</li>
    <li>✅ バリアフリースポットに詳しいドライバー</li>
    <li>✅ 観光中の介助サポートも可能</li>
    <li>✅ 事前予約で安心・確実な移動</li>
</ul>
<p class="mt-2">観光スポット間の移動や、一日観光には特におすすめです。ぜひご検討ください。</p>
</div>`;
                            
                            if (!result.tips.includes('介護タクシーいまここ') && !result.tips.includes('090-9011-8526')) {
                                result.tips += '<br><br>' + taxiInfo;
                            }
                            
                            showResult(result);
                        }
                    })
                    .catch(error => {
                        showError(error.message || 'APIの呼び出し中にエラーが発生しました。');
                    });
            });
            
            // オフラインプラン表示ボタン
            useOfflineButton.addEventListener('click', function() {
                let selectedArea = '中部'; // デフォルト
                if (document.getElementById('south').checked) selectedArea = '南部';
                else if (document.getElementById('central').checked) selectedArea = '中部';
                else if (document.getElementById('north').checked) selectedArea = '北部';
                
                // おまかせの場合はランダムに選択
                if (document.getElementById('any').checked) {
                    const areas = ['南部', '中部', '北部'];
                    selectedArea = areas[Math.floor(Math.random() * areas.length)];
                }
                
                // 選択されたエリアのサンプルプランを表示
                const plan = samplePlans[selectedArea] || samplePlans['中部'];
                
                showResult({
                    timeRange: plan.timeRange,
                    plan: plan.plan,
                    tips: plan.tips
                });
            });
            
            // プロンプト作成関数
            function createPrompt(userInput, barrierFreeSpots) {
                return `
あなたは、沖縄のバリアフリー旅行プランを専門的に提案するAIアシスタントです。
車椅子ユーザーとその家族のための1日観光プランを作成してください。

【条件】
・観光時間: ${userInput.startTime}～${userInput.endTime}
・人数: 車椅子利用者${userInput.wheelchairUsers}名、同行者${userInput.companions}名
・興味のあるテーマ: ${userInput.themes.join(', ')}
・希望エリア: ${userInput.area}
・バリアフリー対応の希望: ${userInput.barrierFreeRequests.join(', ')}
・追加リクエスト: ${userInput.additionalRequests}

【バリアフリー対応施設の情報】
\`\`\`
${JSON.stringify(barrierFreeSpots, null, 2)}
\`\`\`

【プラン作成の際の注意点】
1. 移動時間も考慮した、無理のない時間配分を行ってください
2. 各スポットの所要時間を明示してください（例: 9:30〜11:00 首里城）
3. 車椅子ユーザーが利用しやすいトイレ休憩や食事タイムを適宜組み込んでください
4. バリアフリー対応の詳細情報も具体的に記載してください（例: スロープあり、車椅子対応トイレあり）
5. 各スポット間の移動には車いすでの移動時間を考慮してください
6. プランは必ず指定された時間内（${userInput.startTime}～${userInput.endTime}）に収まるようにしてください
7. 介護タクシーいまここ（連絡先：090-9011-8526）の利用を推奨する内容を旅行のヒントとアドバイスに必ず含めてください

【出力形式】
次の形式で旅行プランを作成してください:

観光可能時間：${userInput.startTime}～${userInput.endTime}

【旅行プラン】
🕘 [開始時間] 出発（ホテルなど）
🏯 [時間帯] [スポット名]（バリアフリー対応内容）
☕ [時間帯] [レストラン/カフェ名]（バリアフリー対応内容）
🌊 [時間帯] [スポット名]（バリアフリー対応内容）
...

【旅行のヒントとアドバイス】
・車椅子ユーザーへの具体的なアドバイス
・おすすめのポイントや注意点
・天候や混雑状況に応じた代替案
・介護タクシーいまここ（090-9011-8526）の利用案内（必ず含める）

マークダウン形式で読みやすく、絵文字も適切に使用して作成してください。
`;
            }

            // Gemini APIを呼び出す関数（最新APIに対応）
            async function callGeminiAPI(apiKey, prompt) {
                try {
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=' + apiKey, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 2048,
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `APIエラー: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    
                    if (!data.candidates || data.candidates.length === 0) {
                        throw new Error('APIからの応答が空です。');
                    }

                    // レスポンスからテキストを抽出
                    const responseText = data.candidates[0].content.parts[0].text;
                    return parseResponse(responseText);
                } catch (error) {
                    console.error('Gemini API error:', error);
                    throw error;
                }
            }

            // レスポンスのパース
            function parseResponse(text) {
                // タイトルと内容を分離
                const timeRangeMarker = "観光可能時間：";
                const planMarker = "【旅行プラン】";
                const tipsMarker = "【旅行のヒントとアドバイス】";
                
                // 観光可能時間の取得
                let timeRangeText = "";
                if (text.includes(timeRangeMarker)) {
                    const startIndex = text.indexOf(timeRangeMarker) + timeRangeMarker.length;
                    const endIndex = text.indexOf("\n", startIndex);
                    if (endIndex !== -1) {
                        timeRangeText = text.substring(startIndex, endIndex).trim();
                    }
                }
                
                // 旅行プランの取得
                let planText = "";
                if (text.includes(planMarker)) {
                    const startIndex = text.indexOf(planMarker) + planMarker.length;
                    let endIndex = text.length;
                    if (text.includes(tipsMarker)) {
                        endIndex = text.indexOf(tipsMarker);
                    }
                    planText = text.substring(startIndex, endIndex).trim();
                }
                
                // 旅行のヒントとアドバイスの取得
                let tipsText = "";
                if (text.includes(tipsMarker)) {
                    tipsText = text.substring(text.indexOf(tipsMarker) + tipsMarker.length).trim();
                }
                
                return {
                    timeRange: timeRangeText,
                    plan: planText,
                    tips: tipsText
                };
            }

            // ローディング表示
            function showLoading() {
                initialMessage.classList.add('hidden');
                errorMessage.classList.add('hidden');
                planResult.classList.add('hidden');
                loadingIndicator.classList.remove('hidden');
            }

            // エラー表示
            function showError(message) {
                initialMessage.classList.add('hidden');
                loadingIndicator.classList.add('hidden');
                planResult.classList.add('hidden');
                errorMessage.classList.remove('hidden');
                errorDetails.textContent = message;
            }

            // 結果表示
            function showResult(result) {
                initialMessage.classList.add('hidden');
                loadingIndicator.classList.add('hidden');
                errorMessage.classList.add('hidden');
                planResult.classList.remove('hidden');
                
                timeRange.innerHTML = `<p><strong>観光可能時間：</strong>${result.timeRange}</p>`;
                
                // プランの内容をHTMLに変換（絵文字を保持）
                const planHtml = result.plan
                    .replace(/\n/g, '<br>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                planContent.innerHTML = planHtml;
                
                // ヒントと注意点の表示（もしあれば）
                if (result.tips && result.tips.trim().length > 0) {
                    // 介護タクシーいまここの情報が含まれているか確認
                    if (!result.tips.includes('介護タクシーいまここ') && !result.tips.includes('090-9011-8526')) {
                        // 含まれていない場合は追加
                        const taxiInfo = `<div class="taxi-info">
<h3 class="font-bold mb-2">【介護タクシーのご利用をおすすめします】</h3>
<p>沖縄での車椅子旅行には、専門知識を持ったスタッフによる介護タクシーのご利用が便利です。</p>
<p class="taxi-contact mt-2">📞 介護タクシーいまここ：090-9011-8526</p>
<ul class="mt-2 list-none">
    <li>✅ 車椅子のままでの乗車が可能</li>
    <li>✅ バリアフリースポットに詳しいドライバー</li>
    <li>✅ 観光中の介助サポートも可能</li>
    <li>✅ 事前予約で安心・確実な移動</li>
</ul>
<p class="mt-2">観光スポット間の移動や、一日観光には特におすすめです。ぜひご検討ください。</p>
</div>`;
                        result.tips += taxiInfo;
                    }
                    
                    const tipsHtml = result.tips
                        .replace(/\n/g, '<br>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    
                    planTips.innerHTML = tipsHtml;
                    tipSection.classList.remove('hidden');
                } else {
                    // ヒントがない場合でも介護タクシーの情報は表示
                    planTips.innerHTML = `<div class="taxi-info">
<h3 class="font-bold mb-2">【介護タクシーのご利用をおすすめします】</h3>
<p>沖縄での車椅子旅行には、専門知識を持ったスタッフによる介護タクシーのご利用が便利です。</p>
<p class="taxi-contact mt-2">📞 介護タクシーいまここ：090-9011-8526</p>
<ul class="mt-2 list-none">
    <li>✅ 車椅子のままでの乗車が可能</li>
    <li>✅ バリアフリースポットに詳しいドライバー</li>
    <li>✅ 観光中の介助サポートも可能</li>
    <li>✅ 事前予約で安心・確実な移動</li>
</ul>
<p class="mt-2">観光スポット間の移動や、一日観光には特におすすめです。ぜひご検討ください。</p>
</div>`;
                    tipSection.classList.remove('hidden');
                }
            }

            // コピーボタン
            copyPlanBtn.addEventListener('click', function() {
                const timeRangeText = document.getElementById('timeRange').textContent;
                const planText = document.getElementById('planContent').innerText;
                let tipsText = '';
                
                if (!tipSection.classList.contains('hidden')) {
                    tipsText = '\n\n【旅行のヒントとアドバイス】\n' + document.getElementById('planTips').innerText;
                }
                
                const fullText = timeRangeText + '\n\n【旅行プラン】\n' + planText + tipsText;
                
                navigator.clipboard.writeText(fullText).then(() => {
                    alert('旅行プランをクリップボードにコピーしました！');
                }).catch(err => {
                    console.error('コピーに失敗しました: ', err);
                    alert('コピーに失敗しました。テキストを手動で選択してコピーしてください。');
                });
            });

            // 印刷ボタン
            printPlanBtn.addEventListener('click', function() {
                window.print();
            });

            // 新規作成ボタン
            newPlanBtn.addEventListener('click', function() {
                initialMessage.classList.remove('hidden');
                loadingIndicator.classList.add('hidden');
                errorMessage.classList.add('hidden');
                planResult.classList.add('hidden');
            });

            // 再試行ボタン
            retryButton.addEventListener('click', function() {
                travelForm.dispatchEvent(new Event('submit'));
            });
        });
    </script>
</body>
</html>
